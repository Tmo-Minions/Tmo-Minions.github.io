<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é­”æ³•å·¥è‰ºä¹å®«æ ¼ç†„ç¯å°æ¸¸æˆè§£å¯†å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 10px; }
        .container { width: 100%; max-width: 400px; background: white; border-radius: 16px; padding: 20px; box-shadow: 0 6px 18px rgba(0,0,0,0.05); }
        h1 { text-align: center; color: #2c3e50; font-size: 22px; margin-bottom: 6px; }
        .subtitle { text-align: center; color: #7f8c8d; font-size: 13px; margin-bottom: 20px; }
        .solution { background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 20px; }
        .solution-title { font-size: 14px; color: #555; margin-bottom: 6px; }
        .solution-steps { font-size: 18px; color: #3498db; text-align: center; font-weight: bold; min-height: 24px; }
        .mode { display: flex; gap: 8px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: none; background: #ecf0f1; border-radius: 8px; color: #34495e; font-weight: 600; cursor: pointer; }
        .mode-btn.active { background: #3498db; color: white; }
        .controls { display: flex; gap: 8px; margin-bottom: 20px; }
        .control-btn { flex: 1; padding: 14px 8px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; color: white; font-size: 14px; text-align: center; }
        .new-game { background: #2ecc71; }
        .special { background: #9b59b6; }
        .solve { background: #e74c3c; }
        .info { text-align: center; background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 20px; font-size: 15px; color: #2c3e50; }
        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 260px; height: 260px; margin: 0 auto; }
        .light { border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; transition: 0.2s; user-select: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .light.on { background: #f1c40f; color: white; box-shadow: 0 0 20px rgba(241, 196, 15, 0.6); }
        .light.off { background: #34495e; color: #bdc3c7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ä¹å®«æ ¼ç†„ç¯å°æ¸¸æˆ</h1>
        <div class="subtitle">ç‚¹å‡»æ ¼å­æ”¹å˜ç¯çš„çŠ¶æ€ï¼Œé»„è‰²ä»£è¡¨ç¯äº®ï¼Œç›®æ ‡ï¼šç‚¹äº®æ‰€æœ‰ç¯</div>
        <div class="solution">
            <div class="solution-steps" id="solutionSteps">ç‚¹å‡»è§£å¯†å¯è·å–è§£å¯†æ­¥éª¤</div>
        </div>
        <div class="mode">
            <button class="mode-btn active" id="randomModeBtn">éšæœºæ¨¡å¼ç»ƒä¹ å®¤</button>
            <button class="mode-btn" id="customModeBtn">æ¸¸æˆå†…å½“å‰è®¾ç½®</button>
        </div>
        <div class="controls">
            <button class="control-btn new-game" id="newGameBtn">é‡ç½®æ¸¸æˆ</button>
            <button class="control-btn special" id="specialPatternBtn">åªæœ‰ä¸€ä¸ªç­ç¯æ¨¡å¼</button>
            <button class="control-btn solve" id="solveBtn">è§£å¯†æ­¥éª¤</button>
        </div>
        <div class="info" id="gameInfo">ç‚¹å‡»å¼€å§‹æ¸¸æˆ</div>
        <div class="board" id="gameBoard"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let gameMode = 'random';
            let lights = Array(9).fill(false);
            const boardElement = document.getElementById('gameBoard');
            const gameInfoElement = document.getElementById('gameInfo');
            const solutionStepsElement = document.getElementById('solutionSteps');

            function initBoard() {
                boardElement.innerHTML = '';
                for (let i = 0; i < 9; i++) {
                    const lightElement = document.createElement('div');
                    lightElement.className = 'light off';
                    lightElement.textContent = i + 1;
                    lightElement.dataset.index = i;
                    lightElement.addEventListener('click', () => toggleLight(i));
                    boardElement.appendChild(lightElement);
                }
                updateBoard();
            }

            function updateBoard() {
                const lightElements = document.querySelectorAll('.light');
                lightElements.forEach((element, index) => {
                    if (lights[index]) {
                        element.classList.remove('off');
                        element.classList.add('on');
                    } else {
                        element.classList.remove('on');
                        element.classList.add('off');
                    }
                });
                const onCount = lights.filter(light => light).length;
                gameInfoElement.textContent = `å·²ç‚¹äº®: ${onCount}/9`;
                if (onCount === 9) {
                    gameInfoElement.innerHTML = `ğŸ‰ æ­å–œï¼å…¨éƒ¨ç‚¹äº®ï¼`;
                    gameInfoElement.style.color = '#2ecc71';
                } else {
                    gameInfoElement.style.color = '#2c3e50';
                }
            }

            function toggleLight(index) {
                if (gameMode === 'random') {
                    toggleSingleLight(index);
                    if (index >= 3) toggleSingleLight(index - 3);
                    if (index <= 5) toggleSingleLight(index + 3);
                    if (index % 3 !== 0) toggleSingleLight(index - 1);
                    if (index % 3 !== 2) toggleSingleLight(index + 1);
                } else {
                    toggleSingleLight(index);
                }
                updateBoard();
            }

            function toggleSingleLight(index) {
                lights[index] = !lights[index];
            }

            function newRandomGame() {
                solutionStepsElement.textContent = '';
                const onCount = Math.floor(Math.random() * 9);
                const indices = Array.from({length: 9}, (_, i) => i);
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                lights = Array(9).fill(false);
                for (let i = 0; i < onCount; i++) {
                    lights[indices[i]] = true;
                }
                updateBoard();
            }

            function specialPattern() {
                solutionStepsElement.textContent = 'ç‚¹å‡»è§£å¯†å¯è·å–è§£å¯†æ­¥éª¤';
                lights = Array(9).fill(true);
                const randomIndex = Math.floor(Math.random() * 9);
                lights[randomIndex] = false;
                updateBoard();
            }

            function calculateSolution() {
                const matrix = [];
                for (let i = 0; i < 9; i++) {
                    const row = Array(9).fill(0);
                    row[i] = 1;
                    if (i >= 3) row[i - 3] = 1;
                    if (i <= 5) row[i + 3] = 1;
                    if (i % 3 !== 0) row[i - 1] = 1;
                    if (i % 3 !== 2) row[i + 1] = 1;
                    matrix.push(row);
                }
                const target = lights.map(light => light ? 0 : 1);
                const solution = gaussianElimination(matrix, target);
                if (solution) {
                    const steps = [];
                    for (let i = 0; i < 9; i++) {
                        if (solution[i] === 1) steps.push(i + 1);
                    }
                    solutionStepsElement.textContent = steps.length === 0 ? "æ— éœ€æ“ä½œ" : steps.join('-');
                } else {
                    solutionStepsElement.textContent = "æ— è§£";
                }
            }

            function gaussianElimination(A, b) {
                const n = 9;
                let matrix = A.map((row, i) => [...row, b[i]]);
                for (let col = 0; col < n; col++) {
                    let pivot = -1;
                    for (let row = col; row < n; row++) {
                        if (matrix[row][col] === 1) {
                            pivot = row;
                            break;
                        }
                    }
                    if (pivot === -1) continue;
                    [matrix[col], matrix[pivot]] = [matrix[pivot], matrix[col]];
                    for (let row = 0; row < n; row++) {
                        if (row !== col && matrix[row][col] === 1) {
                            for (let j = col; j <= n; j++) {
                                matrix[row][j] ^= matrix[col][j];
                            }
                        }
                    }
                }
                const solution = new Array(n).fill(0);
                for (let i = 0; i < n; i++) {
                    if (matrix[i][i] === 1) {
                        solution[i] = matrix[i][n];
                    } else if (matrix[i][n] === 1) {
                        return null;
                    }
                }
                return solution;
            }

            document.getElementById('randomModeBtn').addEventListener('click', function() {
                gameMode = 'random';
                document.getElementById('randomModeBtn').classList.add('active');
                document.getElementById('customModeBtn').classList.remove('active');
                gameInfoElement.textContent = "èµ¶å¿«ç»ƒä¹ å§ï¼Œé•¿è¾¾ä¸¤å¹´åŠçš„ç»ƒä¹ ç”Ÿ";
            });
            document.getElementById('customModeBtn').addEventListener('click', function() {
                gameMode = 'custom';
                document.getElementById('customModeBtn').classList.add('active');
                document.getElementById('randomModeBtn').classList.remove('active');
                gameInfoElement.textContent = "è¯·æ ¹æ®æ¸¸æˆå†…çš„æ ¼å­è®¾ç½®ï¼Œé»„è‰²ä»£è¡¨å·²äº®";
            });
            document.getElementById('newGameBtn').addEventListener('click', newRandomGame);
            document.getElementById('specialPatternBtn').addEventListener('click', specialPattern);
            document.getElementById('solveBtn').addEventListener('click', calculateSolution);

            initBoard();
            newRandomGame();
        });
    </script>
</body>
</html>