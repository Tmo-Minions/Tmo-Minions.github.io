<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>å½±è§†æœç´¢</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ä¿ç•™æ‚¨åŸæœ‰çš„ CSS æ ·å¼ */
        :root {
            --bg-color: #f7f7f7;
            --text-color: #333;
            /* ... å…¶ä»–æ ·å¼å˜é‡ ... */
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            /* ... å…¶ä»–æš—è‰²ä¸»é¢˜æ ·å¼å˜é‡ ... */
        }

        /* ... å…¶ä»–æ ·å¼å®šä¹‰ ... */
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div id="announcementModal">
        <div class="modal-content">
            <h2>ğŸ“¢ å…è´£å£°æ˜</h2>
            <p>æœ¬ç«™æ‰€æœ‰å†…å®¹å‡æ¥è‡ªäº’è”ç½‘ï¼Œæœ¬ç«™ä¸ä¼šä¿å­˜ã€å¤åˆ¶æˆ–ä¼ æ’­ä»»ä½•è§†é¢‘æ–‡ä»¶ï¼Œä¹Ÿä¸å¯¹æœ¬ç«™ä¸Šçš„ä»»ä½•å†…å®¹è´Ÿæ³•å¾‹è´£ä»»ã€‚å¦‚æœæœ¬ç«™éƒ¨åˆ†å†…å®¹ä¾µçŠ¯æ‚¨çš„ç‰ˆæƒè¯·å‘ŠçŸ¥ï¼Œåœ¨å¿…è¦è¯æ˜æ–‡ä»¶ä¸‹æˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æ’¤é™¤ã€‚</p>
            <p><font color="red"><b>è¯·å‹¿ç›¸ä¿¡è§†é¢‘ä¸­çš„ä»»ä½•å¹¿å‘Šï¼</b></font></p>
            <p><b>å¼€æºåœ°å€ï¼š</b><a href="https://github.com/æ‚¨çš„ç”¨æˆ·å/ysss">GitHub</a></p>
            <button id="closeButton" disabled>
                <span id="countdownText">5</span> ç§’åå¯å…³é—­
            </button>
        </div>
    </div>

    <div id="container">
        <h1>å½±è§†æœç´¢</h1>

        <div id="searchForm">
            <form id="searchFormElement" style="display: flex; justify-content: center; align-items: center;">
                <input type="text" id="searchInput" placeholder="è¯·è¾“å…¥å½±ç‰‡åç§°" style="flex-grow: 1; padding: 10px 10px; font-size: 16px; border: 1px solid var(--border-color); border-radius: 5px; margin-right: 10px; background-color: var(--input-bg); color: var(--input-text);"/>
                
                <div class="select-wrapper">
                    <select id="sourceSelect">
                        <option value="1">ç‰‡æº1</option>
                        <option value="2">ç‰‡æº2</option>
                        <option value="3">ç‰‡æº3</option>
                        <option value="4">ç‰‡æº4</option>
                        <option value="5">ç‰‡æº5</option>
                        <option value="6">ç‰‡æº6</option>
                    </select>
                    <div class="select-arrow">
                        <i class="fas fa-angle-down"></i>
                    </div>
                </div>

                <button type="submit" style="padding: 10px 15px; font-size: 16px; color: white; background-color: var(--button-bg); border: none; border-radius: 5px; cursor: pointer; white-space: nowrap; text-align: center; vertical-align: middle; display: inline-flex; justify-content: center; align-items: center;">æœç´¢</button>
            </form>
        </div>

        <div id="movieList" style="display: none;">
            <h3>ğŸ” æœç´¢ç»“æœ</h3>
            <!-- æœç´¢ç»“æœå°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
        </div>

        <div id="movieDetails" style="display: none;">
            <h3>ğŸ¬ å½±ç‰‡è¯¦æƒ…</h3><hr>
            <div class="movie-info">
                <div class="details">
                    <table id="movieInfoTable">
                        <!-- å½±ç‰‡è¯¦æƒ…å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
                    </table>
                </div>
                <div class="poster">
                    <img id="moviePoster" src="" alt="" style="max-width: 100%;">
                </div>
            </div>

            <div class="content">
                <h3>ğŸ’¬ å½±ç‰‡ç®€ä»‹</h3><hr>
                <p id="movieContent"></p>
            </div><br>

            <h3>ğŸ” æ’­æ”¾åˆ—è¡¨</h3><hr>
            <div id="playList">
                <!-- æ’­æ”¾åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <!-- æ·»åŠ ä¸‹è½½åŒºåŸŸ -->
        <div id="downloadSection" style="margin-top: 30px; background-color: var(--container-bg); border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
            <h3>ğŸ“¥ èµ„æºä¸‹è½½</h3><hr>
            <div class="download-list">
                <div class="download-item" style="padding: 15px; margin-bottom: 10px; background-color: var(--movie-list-bg); border-radius: 5px; transition: all 0.3s ease;">
                    <a href="https://github.com/æ‚¨çš„ç”¨æˆ·å/ysss/raw/main/XZ/DLç‰©å“æŸ¥è¯¢å·¥å…·v1.0.zip" style="display: flex; justify-content: space-between; text-decoration: none; color: var(--text-color);">
                        <span><strong>DLç‰©å“æŸ¥è¯¢å·¥å…·v1.0</strong></span>
                        <span class="download-btn" style="background-color: var(--button-bg); color: white; padding: 5px 10px; border-radius: 5px;">ä¸‹è½½</span>
                    </a>
                </div>
                
                <div class="download-item" style="padding: 15px; margin-bottom: 10px; background-color: var(--movie-list-bg); border-radius: 5px; transition: all 0.3s ease;">
                    <a href="https://github.com/æ‚¨çš„ç”¨æˆ·å/ysss/raw/main/XZ/æ¶ˆå…‰å¤§è›‡æ”¹é€¼å·¥å…· v1.3.zip" style="display: flex; justify-content: space-between; text-decoration: none; color: var(--text-color);">
                        <span><strong>æ¶ˆå…‰å¤§è›‡æ”¹é€¼å·¥å…· v1.3</strong></span>
                        <span class="download-btn" style="background-color: var(--button-bg); color: white; padding: 5px 10px; border-radius: 5px;">ä¸‹è½½</span>
                    </a>
                </div>
                
                <div class="download-item" style="padding: 15px; margin-bottom: 10px; background-color: var(--movie-list-bg); border-radius: 5px; transition: all 0.3s ease;">
                    <a href="https://github.com/æ‚¨çš„ç”¨æˆ·å/ysss/raw/main/XZ/èåœåŠ©æ‰‹v1.6.1.exe" style="display: flex; justify-content: space-between; text-decoration: none; color: var(--text-color);">
                        <span><strong>èåœåŠ©æ‰‹v1.6.1</strong></span>
                        <span class="download-btn" style="background-color: var(--button-bg); color: white; padding: 5px 10px; border-radius: 5px;">ä¸‹è½½</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;
        
        function toggleTheme() {
            const currentTheme = htmlElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            htmlElement.setAttribute('data-theme', newTheme);
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            
            localStorage.setItem('theme_preference', newTheme);
        }
        
        themeToggle.addEventListener('click', toggleTheme);
        
        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme_preference');
            if (savedTheme) {
                htmlElement.setAttribute('data-theme', savedTheme);
                themeToggle.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                htmlElement.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
        
        // å…¬å‘ŠåŠŸèƒ½
        function shouldShowAnnouncement() {
            const lastShownDate = localStorage.getItem('lastShownDate');
            const today = new Date().toLocaleDateString();
            return lastShownDate !== today;
        }

        function showAnnouncement() {
            const modal = document.getElementById('announcementModal');
            const closeButton = document.getElementById('closeButton');
            const countdownText = document.getElementById('countdownText');
            let countdown = 5;

            modal.style.display = 'block';

            const timer = setInterval(() => {
                countdown--;
                countdownText.textContent = countdown;

                if (countdown > 0) {
                    closeButton.disabled = true;
                    closeButton.textContent = `${countdown} ç§’åå¯å…³é—­`;
                } else {
                    clearInterval(timer);
                    closeButton.disabled = false;
                    closeButton.textContent = 'å…³é—­å…¬å‘Š';
                }
            }, 1000);

            closeButton.onclick = () => {
                localStorage.setItem('lastShownDate', new Date().toLocaleDateString());
                modal.style.display = 'none'; 
            };
        }

        // æœç´¢åŠŸèƒ½
        document.getElementById('searchFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            const searchQuery = document.getElementById('searchInput').value.trim();
            const selectedSource = document.getElementById('sourceSelect').value;
            
            if (searchQuery) {
                searchMovies(searchQuery, selectedSource);
            }
        });

        function searchMovies(query, source) {
            const searchUrl = `https://baiapi.cn/api/ysss?y=${source}&wd=${encodeURIComponent(query)}`;
            
            fetch(searchUrl)
                .then(response => response.json())
                .then(data => {
                    displaySearchResults(data, query, source);
                })
                .catch(error => {
                    console.error('æœç´¢å‡ºé”™:', error);
                    alert('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                });
        }

        function displaySearchResults(data, query, source) {
            const movieList = document.getElementById('movieList');
            movieList.style.display = 'block';
            document.getElementById('movieDetails').style.display = 'none';
            
            // æ¸…ç©ºç°æœ‰ç»“æœ
            movieList.innerHTML = '<h3>ğŸ” æœç´¢ç»“æœ</h3>';
            
            if (data && data.list && data.list.length > 0) {
                data.list.forEach(movie => {
                    const button = document.createElement('button');
                    button.textContent = `${movie.vod_name} - ${movie.vod_remarks}`;
                    button.onclick = function() {
                        getMovieDetails(movie.vod_id, source);
                    };
                    movieList.appendChild(button);
                });
            } else {
                const noResults = document.createElement('p');
                noResults.textContent = 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å½±ç‰‡';
                movieList.appendChild(noResults);
            }
        }

        function getMovieDetails(movieId, source) {
            const detailsUrl = `https://baiapi.cn/api/ysss?y=${source}&id=${encodeURIComponent(movieId)}`;
            
            fetch(detailsUrl)
                .then(response => response.json())
                .then(data => {
                    displayMovieDetails(data);
                })
                .catch(error => {
                    console.error('è·å–å½±ç‰‡è¯¦æƒ…å‡ºé”™:', error);
                    alert('è·å–å½±ç‰‡è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                });
        }

        function displayMovieDetails(data) {
            if (!data || !data.name) {
                alert('è·å–å½±ç‰‡è¯¦æƒ…å¤±è´¥');
                return;
            }
            
            document.getElementById('movieList').style.display = 'none';
            const movieDetails = document.getElementById('movieDetails');
            movieDetails.style.display = 'block';
            
            // è®¾ç½®æµ·æŠ¥
            document.getElementById('moviePoster').src = data.pic;
            document.getElementById('moviePoster').alt = data.name;
            
            // è®¾ç½®å½±ç‰‡ä¿¡æ¯è¡¨æ ¼
            const infoTable = document.getElementById('movieInfoTable');
            infoTable.innerHTML = `
                <tr><th>å¯¼æ¼”</th><td>${data.director || 'æœªçŸ¥'}</td></tr>
                <tr><th>ç±»å‹</th><td>${data.class || 'æœªçŸ¥'}</td></tr>
                <tr><th>æ—¥æœŸ</th><td>${data.pubdate || 'æœªçŸ¥'}</td></tr>
                <tr><th>è¯„åˆ†</th><td>${data.douban_score || 'æœªçŸ¥'}</td></tr>
                <tr><th>åœ°åŒº</th><td>${data.area || 'æœªçŸ¥'}</td></tr>
            `;
            
            // è®¾ç½®ç®€ä»‹
            document.getElementById('movieContent').innerHTML = data.content || 'æš‚æ— ç®€ä»‹';
            
            // è®¾ç½®æ’­æ”¾åˆ—è¡¨
            const playList = document.getElementById('playList');
            playList.innerHTML = '';
            
            if (data.play_url && Array.isArray(data.play_url) && data.play_url.length > 0) {
                data.play_url.forEach(episode => {
                    const link = document.createElement('a');
                    link.href = `https://baiapi.cn/api/webbfq?&apiKey=b458d0b622fc7634bf24c5e6a956d352&url=${encodeURIComponent(episode.link)}`;
                    link.className = 'play-button';
                    link.target = '_blank';
                    link.textContent = episode.title;
                    playList.appendChild(link);
                });
            } else {
                playList.innerHTML = '<p>æš‚æ— æ’­æ”¾åˆ—è¡¨ã€‚</p>';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            
            if (shouldShowAnnouncement()) {
                showAnnouncement();
            }
            
            // ä» URL å‚æ•°è·å–æœç´¢æŸ¥è¯¢å’Œç‰‡æº
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('search');
            const source = urlParams.get('y') || '1';
            
            // è®¾ç½®é€‰æ‹©çš„ç‰‡æº
            document.getElementById('sourceSelect').value = source;
            
            // å¦‚æœæœ‰æœç´¢æŸ¥è¯¢ï¼Œæ‰§è¡Œæœç´¢
            if (searchQuery) {
                document.getElementById('searchInput').value = searchQuery;
                searchMovies(searchQuery, source);
                
                // å¦‚æœæœ‰ç”µå½± IDï¼Œè·å–ç”µå½±è¯¦æƒ…
                const movieId = urlParams.get('movie_id');
                if (movieId) {
                    getMovieDetails(movieId, source);
                }
            }
        });
    </script>
</body>
</html>
